# Postgres_dvdrental_project

## OVERVIEW:
This project modifies a sample Postgres database, dvdrental, and creates multiple functions, triggers, and new tables. Once the database is updated, the project provides a python script to run in the background that will listen for updates to the ‘film’ table and send an email if certain conditions are met. For convenience, the project also provides a short insert script with a set of sample film entries that include films that will trigger the script as well as two sample films that should not trigger it. Instructions to set up and run the project can be found below the summary.

## SUMMARY OF PROJECT:
Once a staple in cities around the world, video rental stores no longer enjoy the popularity they once did. EHQ Video is one of the last remaining video stores, with locations in Lethbridge, Alberta, Canada, and Woodridge, Queensland, Australia. EHQ Video has been able to remain in business through offering rare, hard-to-find films, and by carefully cultivating lasting relationships with its customers. 
	
EHQ Video would like to increase its engagement with its customer base by identifying the customers who have rented the highest number of films and enrolling them in a “top customer” program, analyzing the films rented by top customers, and proactively recommending new films to top customers when a new film is released with a similar description to movies those customers have rented before.
	
Using EHQ Video’s extensive dataset containing information about its films, customers, and rental data, four new tables will be created to gather and aggregate data to support its top customer program. First, a new detailed table, customer_rentals, will be created from data from the pre-existing customer, rental, inventory, and film tables. Second, three new summary tables will be created from customer_rentals: rentals_per_customer, top_customer_movies, and popular_among_top_customers. The three summary tables are explained in more detail below, but at a high level, they identify EHQ Video’s top customers and the movies that have been rented most often by the top customers. 
	
In addition, adding a new film to the film table will trigger a function, compare_keywords(), that compares the keywords from the description of the new film to an array of keywords populated from the movies that have been rented most often by top customers. If three or more keywords from the new movie are in the list of keywords from the movies that are popular with top customers, the function will notify a Python script that is running in the background and listening on the same channel. The Python script will be connected to the database and to an email account set up by EHQ Video at the same time. When the trigger function conditions are met and the notification is transmitted on the channel, the Python script will send an email from EHQ Video to each top customer letting them know that a new movie has been released that they might enjoy, and containing the title and description of the movie.

## INSTRUCTIONS:
1.	To run the script as written, you will need a gmail account with an app password set up. (You can create a separate email for this in order to avoid using a primary accout if desired). There should be instructions at this link: https://myaccount.google.com/apppasswords. Once you set up the app password, copy it and paste it somewhere secure. You will need to remove the spaces to use it in the main.py script where indicated. 
2.	Download and install Postgres if not installed.
3.	Download and update the sample dvd rental database. There are instructions for installing the database from a .tar file (the GeeksForGeeks link below provides a .tar file) using either PG Admin or psql available online. Postgres does not seem to have the database available any longer; I found a copy from GeeksForGeeks at: https://www.geeksforgeeks.org/postgresql/postgresql-loading-a-database/ that was still available as of December 20, 2025.
4.	Using Postgres connected to the dvd rental database, run the entirety of EHQ_movies.sql in either PG Admin or psql. EHQ_movies.sql creates all the functions, triggers, and tables used in the main script.
5.	In order to test the script, modify test_table_working_emails.sql to fill in names and working emails where indicated and execute it. The reason for this is because the emails in the sample database are not real emails, so they won’t work to test the script. If desired, you can update the rentals_per_customer table directly and modify the python script accordingly by changing the query to rpc_test to use rentals_per_customer instead, but that table is part of EHQ_movies.sql, so it will be dropped and repopulated without your data if you end up re-running it. The rpc_test table created by test_table_working_emails.sql is unaffected by anything in EHQ_movies.sql, which makes it useful for testing.
6.	Modify main.py to add your gmail address and app password where indicated in all caps. 
7.	Modify main.py to add your postgres username (the default is typically just ‘postgres’) and postgres password where indicated in all caps. 
8.	Run main.py in the IDE/terminal of your choice. You may need to use pip install [library] in the terminal for any libraries that are not already imported. If desired, you can store it in the file with the SQL scripts and execute using your operating system’s terminal/command prompt.
9.	Once main.py is running, run the test_films.sql script. There is an optional query at the top that will show you all the keywords if you want to try modifying the test films to create your own descriptions.
